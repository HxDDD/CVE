# CVE-2021-41773

## 1. 환경 구성
+ **Ubuntu 20.04 버전**

+ **Apache 2.4.49~50 버전**
  - apr 1.7.0 설치
  - apr util 1.6.1 설치

- **라이브러리 설치**
  - pcre3 - apt-get install libpcre3-dev
  - ssl - apt-get install libssl-dev
  - expat1 - apt-get install libexpat1-dev

- **apache 소스 컴파일** 

  - ./configure --prefix=/usr/local/apache --enable-so --enable-rewrite --enable-ssl --enable-mods-shared=all --enable-modules=shared --enable-mpms-shared=all --with-included-apr --enable-unique-id

  - make -j 8 ; make install

- **httpd 스크립트 복사 및 서비스 등재**

  - cp -a /usr/local/apache/bin/apachectl /etc/init.d/httpd
  - ln -s /etc/init.d/httpd /etc/rc3.d/S99httpd

- **Apache 시작**

  - /etc/init.d/httpd start

  ![2](C:\Users\9000937\Desktop\이미지 자료\2.png)





## 1-1. 정보 수집

1. apache default 오류페이지 확인 후 Directory Traversal 취약점 확인하였으나 실패

   ![4](C:\Users\9000937\Desktop\이미지 자료\4.png)



2. nmap을 통해 아파치 서버 정보(2.4.49) 확인

   ![5](C:\Users\9000937\Desktop\이미지 자료\5.png)



## 2. PoC

1. curl을 통해 사용자 계정 정보가 노출되는것을 확인

   ![6](C:\Users\9000937\Desktop\이미지 자료\6.png)

   

2. curl을 통해 사용자 그룹 관리 정보가 노출되는것을 확인

   ![7](C:\Users\9000937\Desktop\이미지 자료\7.png)



## 3. 원인 분석

1. httpd.conf 설정 파일 중 Directory/ 부분이 denied가 아닌 granted(허용)되어 취약점 발생

   ![1](C:\Users\9000937\Desktop\이미지 자료\1.png)



 2. URL 매핑 부분에서 취약점이 발생됨을 이용하여 directory traversal attack이 가능한것을 확인

    ![소스코드](C:\Users\9000937\Desktop\이미지 자료\소스코드.png)

​	

## 4. 대응 방안

	1. httpd.conf 설정 파일 중 Directory/ 부분을 denied로 변경
 	2. Apache 서버 정보(2.4.49~50)가 노출되지 않게 수정
 	3. Apache default 오류페이지가 노출되지 않게 수정



## 5. 참조

https://httpd.apache.org/security/vulnerabilities_24.html

https://github.com/lorddemon/CVE-2021-41773-PoC/

https://github.com/iilegacyyii/PoC-CVE-2021-41773

https://library.gabia.com/contents/infrahosting/3513/





